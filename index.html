<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>의약품 검색</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .container {
            display: flex;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            max-width: 1000px;
            width: 100%;
        }
        .search-section {
            flex: 2;
            padding-right: 2rem;
        }
        .email-section {
            flex: 1;
            border-left: 1px solid #ddd;
            padding-left: 2rem;
        }
        #search-input {
            width: calc(100% - 80px);
            padding: 0.5rem;
            font-size: 1rem;
            margin-bottom: 1rem;
            box-sizing: border-box;
        }
        #search-button {
            width: 70px;
            padding: 0.5rem;
            font-size: 1rem;
            margin-bottom: 1rem;
            box-sizing: border-box;
        }
        #results {
            text-align: left;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .info-text {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 1rem;
        }
        #email-input {
            width: 100%;
            padding: 0.5rem;
            font-size: 1rem;
            margin-bottom: 1rem;
            box-sizing: border-box;
        }
        #email-submit {
            width: 100%;
            padding: 0.5rem;
            font-size: 1rem;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
    <!-- Google Analytics 코드 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=YOUR-GA-TRACKING-ID"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'YOUR-GA-TRACKING-ID');
    </script>
</head>
<body>
    <div class="container">
        <div class="search-section">
            <h1>의약품 검색</h1>
            <p class="info-text">의약품 검색 시 나오는 의약품은 모두 '건강보험심사평가원'에서 효과가 동일하다고 입증된 의약품들입니다. 가격이 저렴한 의약품이 있는지, 처방 가능한지 약사님에게 문의 후 처방받으시면 됩니다.</p>
            <input type="text" id="search-input" placeholder="제품코드 또는 제품명 입력">
            <button id="search-button">검색</button>
            <div id="results"></div>
        </div>
        <div class="email-section">
            <p class="info-text">해당 서비스는 '의약품 싸게 사자'는 취지에서 시작한 '쌍둥이 약' 서비스의 베타 버전 서비스입니다. 아래 이메일 입력란에 이메일을 입력해주시면, 정식 출시 시 한 달 간 무료로 서비스를 이용할 수 있는 쿠폰을 보내드립니다 :)</p>
            <input type="email" id="email-input" placeholder="이메일 주소 입력">
            <button id="email-submit">쿠폰 받기</button>
        </div>
    </div>

    <script>
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const resultsDiv = document.getElementById('results');

        // 로컬 JSON 데이터
        const medicines = [
            {
                "제품코드": "001",
                "제품명": "약품A",
                "업체명": "제약사A",
                "규격": "100mg",
                "단위": "알",
                "상한금액": "1000원"
            },
            {
                "제품코드": "002",
                "제품명": "약품B",
                "업체명": "제약사B",
                "규격": "200mg",
                "단위": "알",
                "상한금액": "2000원"
            },
            {
                "제품코드": "003",
                "제품명": "두타스테리드",
                "업체명": "제약사C",
                "규격": "0.5mg",
                "단위": "캡슐",
                "상한금액": "1500원"
            }
        ];

        searchButton.addEventListener('click', search);
        searchInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                search();
            }
        });

        function search() {
            const query = searchInput.value.trim().toLowerCase();
            if (query.length === 0) {
                resultsDiv.innerHTML = '';
                return;
            }

            const filteredResults = medicines.filter(medicine => 
                medicine['제품코드'].toLowerCase().includes(query) || 
                medicine['제품명'].toLowerCase().includes(query)
            );

            displayResults(filteredResults);
        }

        function displayResults(results) {
            if (results.length === 0) {
                resultsDiv.innerHTML = '<p>검색 결과가 없습니다.</p>';
                return;
            }

            let html = '<table><tr><th>제품코드</th><th>제품명</th><th>업체명</th><th>규격</th><th>단위</th><th>상한금액</th></tr>';
            for (const medicine of results) {
                html += `
                    <tr>
                        <td>${medicine['제품코드']}</td>
                        <td>${medicine['제품명']}</td>
                        <td>${medicine['업체명']}</td>
                        <td>${medicine['규격']}</td>
                        <td>${medicine['단위']}</td>
                        <td>${medicine['상한금액']}</td>
                    </tr>
                `;
            }
            html += '</table>';
            resultsDiv.innerHTML = html;
        }

        // 이메일 제출 기능
        const emailInput = document.getElementById('email-input');
        const emailSubmit = document.getElementById('email-submit');

        emailSubmit.addEventListener('click', async function() {
            const email = emailInput.value.trim();
            if (email) {
                try {
                    const response = await fetch('/save_email', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email: email }),
                    });
                    const data = await response.json();
                    if (data.success) {
                        alert('이메일이 성공적으로 저장되었습니다.');
                        emailInput.value = '';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('이메일 저장에 실패했습니다. 다시 시도해주세요.');
                }
            } else {
                alert('유효한 이메일 주소를 입력해주세요.');
            }
        });

        // Google Analytics 이벤트 추적
        searchButton.addEventListener('click', function() {
            gtag('event', 'search', {
                'event_category': 'engagement',
                'event_label': 'search_button_click'
            });
        });

        emailSubmit.addEventListener('click', function() {
            gtag('event', 'email_submit', {
                'event_category': 'engagement',
                'event_label': 'email_submit_click'
            });
        });
    </script>
</body>
</html>
